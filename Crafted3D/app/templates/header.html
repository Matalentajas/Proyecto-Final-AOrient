<!-- 
Este archivo define el encabezado de una p√°gina web, incluyendo varias secciones interactivas y elementos de navegaci√≥n. A continuaci√≥n, se detalla cada parte del c√≥digo:

1. **Encabezado Principal (`<header>`)**:
   - Contiene tres secciones principales:
     - **Selector de Moneda**: Un men√∫ desplegable que permite al usuario seleccionar una moneda (EU, US, CH, JP, UK). Al seleccionar una opci√≥n, se actualiza el bot√≥n principal con la bandera y el texto correspondientes.
     - **Logo**: Un enlace al inicio de la p√°gina con el logo de la empresa.
     - **Usuario, Buscador y Carrito**:
       - Muestra el nombre del usuario ("Arturo").
       - Incluye un bot√≥n para abrir un buscador.
       - Contiene un carrito de compras interactivo que muestra los productos a√±adidos y un contador de elementos.

2. **Barra de Navegaci√≥n (`<nav>`)**:
   - Una lista de enlaces a diferentes secciones del sitio web (Inicio, Escayolas3D, Almacenaje, Herramientas, Gadgets, Juguetes, Decoraci√≥n).

3. **Secci√≥n de B√∫squeda (`#searchContainer`)**:
   - Un contenedor oculto que se muestra al activar el buscador. Permite al usuario realizar b√∫squedas con un campo de entrada.

4. **Scripts Interactivos**:
   - **Carrito de Compras**:
     - Funci√≥n `toggleCart`: Muestra u oculta el men√∫ del carrito.
     - Funci√≥n `addToCart`: A√±ade productos al carrito, actualiza el contador y muestra la lista de productos.
   - **Selector de Pa√≠s**:
     - Muestra un men√∫ desplegable con opciones de pa√≠ses.
     - Al seleccionar un pa√≠s, actualiza el bot√≥n principal con la bandera y el texto del pa√≠s seleccionado.
     - Cierra el men√∫ si el usuario hace clic fuera del √°rea del men√∫.
   - **Buscador**:
     - Muestra u oculta el contenedor de b√∫squeda.
     - Cierra el buscador si el usuario hace clic fuera del √°rea del buscador.

5. **Estilos y Clases**:
   - Se utilizan clases de Tailwind CSS para el dise√±o responsivo y estilizaci√≥n de los elementos.
   - Clases como `hidden` se usan para mostrar u ocultar elementos din√°micamente.

6. **Im√°genes y Recursos**:
   - Las im√°genes de banderas y el logo se cargan din√°micamente usando `url_for` de Flask para garantizar rutas correctas en el servidor.

En resumen, este archivo combina HTML, CSS (Tailwind) y JavaScript para crear un encabezado interactivo y funcional que mejora la experiencia del usuario en la p√°gina web.
-->

<!-- Header -->
<header>
    <!-- Top Section -->
    <section class="flex items-center justify-between p-4">
        <!-- Currency Selector -->
        <div class="relative flex items-center flex-1">
            <button id="dropdownButton"
            class="cursor-pointer flex items-center text-gray-600 hover:text-gray-800 px-6 py-3 text-lg">
            <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - EU.png') }}" alt="Bandera UE"
                class="h-[40px] w-[70px] mr-3">
            <span>EU</span>
            <i class="fa-solid fa-square-caret-down ml-3 text-xl"></i>
            </button>
            <div id="dropdownMenu" class="absolute left-0 top-full w-40 bg-white hidden">
            <!-- Dropdown Options -->
            <a href="#" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 text-lg">
                <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - USA.png') }}"
                alt="Bandera USA" class="h-[40px] w-[70px] mr-3"> US
            </a>
            <a href="#" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 text-lg">
                <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - EU.png') }}" alt="Bandera EU"
                class="h-[40px] w-[70px] mr-3"> EU
            </a>
            <a href="#" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 text-lg">
                <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - CH.png') }}"
                alt="Bandera China" class="h-[40px] w-[70px] mr-3"> CH
            </a>
            <a href="#" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 text-lg">
                <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - JP.png') }}"
                alt="Bandera Jap√≥n" class="h-[40px] w-[70px] mr-3"> JP
            </a>
            <a href="#" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 text-lg">
                <img src="{{ url_for('static', filename='css/images/Banderas/BANDERA - UK.png') }}"
                alt="Bandera UK" class="h-[40px] w-[70px] mr-3"> UK
            </a>
            </div>
        </div>

        <!-- Logo -->
        <div class="flex items-center justify-center flex-1">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='css/images/Logo.webp') }}" alt="Logo Crafted3D"
                    class="h-[100px]">
            </a>
        </div>

        <!-- User, Search, and Cart -->
        <div class="flex items-center justify-end flex-1 gap-5 mr-[20px]">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('usuario.perfil') }}" class="text-2xl text-bold text-[#39CB60]">{{ current_user.nombre_completo }}</a>
            {% else %}
                <a href="{{ url_for('usuario.login') }}" class="text-2xl">Iniciar Sesi√≥n</a>
            {% endif %}
            <button id="searchToggleButton">
                <i class="fa-solid fa-magnifying-glass hover:text-[#39CB60] text-2xl cursor-pointer"></i>
            </button>

            <!-- Carrito de Compras -->
            <div class="relative">
                <button id="cartButton" onclick="toggleCart()" class="relative">
                    <i class="fa-solid fa-cart-shopping hover:text-[#39CB60] text-2xl cursor-pointer"></i>
                    <span id="cart-count" class="bg-red-500 text-white rounded-full px-2 py-1 text-sm hidden">0</span>
                </button>
                <!-- Dropdown del carrito con tama√±o ajustado -->
                <div id="cart-dropdown"
                    class="absolute right-0 top-16 w-[60vh] h-[90vh] bg-white shadow-lg rounded hidden overflow-y-auto p-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Carrito</h3>
                        <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-800">
                            <i class="fa-solid fa-x text-xl cursor-pointer hover:text-[#39CB60]"></i>
                        </button>
                    </div>
                    <hr class="my-2">
                    <div id="cart-empty" class="flex items-center justify-center text-gray-500 text-center mt-4 h-full">
                        Tu carrito est√° vac√≠o
                    </div>
                    <ul id="cart-items" class="hidden"></ul>
                    
                    <!-- Bot√≥n Realizar Pedido -->
                    <div id="realizar-pedido-container" class="mt-6 hidden text-center"></div>
                        <button id="realizar-pedido-btn" class="cursor-pointer bg-gradient-to-r from-green-400 via-green-500 to-green-600 text-white px-8 py-4 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out w-full font-semibold text-lg"
                            onclick="realizarPedido()">üõí Realizar Pedido</button>
                    </div>
                </div>
            </div>


        </div>
    </section>

    <!-- Navigation Bar -->
    <nav>
        <div class="container mx-auto">
            <ul class="flex justify-center gap-[100px] py-3">
                <li><a href="/" class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Inicio</a>
                </li>
                <li><a href="/productos/escayolas3D"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Escayolas3D</a></li>
                <li><a href="/productos/almacenaje"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Almacenaje</a></li>
                <li><a href="/productos/herramientas"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Herramientas</a>
                </li>
                <li><a href="/productos/gadgets"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Gadgets</a></li>
                <li><a href="/productos/juguetes"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Juguetes</a></li>
                <li><a href="/productos/decoracion"
                        class="text-gray-700 hover:text-[#39CB60] text-lg font-bold cursor-pointer">Decoraci√≥n</a></li>
            </ul>
        </div>
    </nav>
</header>

<!-- Search Section -->
<div id="searchContainer" class="container mx-auto mt-2 px-4 hidden">
    <div class="flex justify-between items-center border-t border-gray-200 p-4">
        <form action="{{ url_for('product.buscar') }}" method="GET" class="flex items-center gap-4 w-full">
            <i class="fa-solid fa-magnifying-glass text-2xl"></i>
            <input type="text" name="q" placeholder="B√∫squeda..." class="w-[150vh] px-3 py-2">
            <button type="submit" class="bg-[#39CB60] text-white px-4 py-2 rounded hover:bg-green-600">Buscar</button>
        </form>
        <button id="closeSearchButton">
            <i class="fa-solid fa-x hover:text-[#39CB60] text-2xl cursor-pointer"></i>
        </button>
    </div>
</div>


<script>
            function addToCart(productId) {
            const cantidad = parseInt(document.getElementById("quantity").value);
            if (isNaN(cantidad) || cantidad < 1) {
                alert("‚ùå Introduce una cantidad v√°lida.");
                return;
            }

            const csrfToken = document.querySelector("[name=csrf_token]").value;
            const url = `/agregar_carrito/${parseInt(productId)}`;

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrfToken
                },
                body: JSON.stringify({ cantidad })
            })
            .then(response => response.json())
            .then(data => {
                console.log("üìå Producto a√±adido:", data);

                const carrito = document.getElementById("cart-dropdown");

                if (carrito.classList.contains("hidden")) {
                    toggleCart();  // üöÄ Si est√° cerrado, abrirlo
                } else {
                    cargarCarrito();  // ‚úÖ Si ya est√° abierto, solo actualizar productos
                }
            })
            .catch(error => {
                console.error("‚ùå Error al a√±adir al carrito:", error);
            });
        }


         // üõí Funci√≥n para mostrar/ocultar el carrito
        function toggleCart() {
            const carrito = document.getElementById("cart-dropdown");

            if (carrito.classList.contains("hidden")) {
                cargarCarrito();
            }

            carrito.classList.toggle("hidden");
        }

        // üõí Funci√≥n para cargar el carrito desde el servidor
        function cargarCarrito() {
            fetch("/ver_carrito")
            .then(response => response.json())
            .then(data => {
                console.log("üìå Datos recibidos del servidor:", data);

                if (data.success) {
                    mostrarCarrito(data.productos);  // Llamada a mostrarCarrito()
                } else {
                    console.error("‚ùå Error al obtener el carrito:", data.error);
                }
            })
            .catch(error => {
                console.error("‚ùå Error en la solicitud:", error);
            });
        }

        // üõí Funci√≥n para mostrar los productos del carrito
        function mostrarCarrito(productos) {
            const carritoContenedor = document.getElementById("cart-items");
            carritoContenedor.innerHTML = "";

            if (productos.length === 0) {
                document.getElementById("cart-empty").classList.remove("hidden");
                carritoContenedor.classList.add("hidden");
                document.getElementById("realizar-pedido-container").classList.add("hidden");
                return;
            }

            document.getElementById("cart-empty").classList.add("hidden");
            carritoContenedor.classList.remove("hidden");

            // Mostrar los productos del carrito
            productos.forEach(producto => {
                const precioTotal = (producto.precio * producto.cantidad).toFixed(2);

                const item = document.createElement("li");
                item.classList.add("flex", "items-center", "gap-4", "p-2", "border-b");
                item.innerHTML = `
                    <img src="/static/css/images/${producto.imagen}" alt="${producto.nombre}" class="w-12 h-12 object-cover rounded">
                    <div>
                        <h4 class="text-lg font-bold">${producto.nombre}</h4>
                        <p class="text-gray-600">Precio unitario: ${producto.precio} ‚Ç¨</p>
                        <p class="text-gray-900 font-bold">Total: ${precioTotal} ‚Ç¨</p>

                        <input type="number" id="cantidad-${producto.producto_id}" class="border p-1 w-16 text-center"
                            value="${producto.cantidad}" min="1"
                            onchange="actualizarCantidad(${producto.producto_id}, this.value)">

                        <button class="eliminar-btn bg-red-500 text-white px-2 py-1 rounded ml-4 hover:bg-red-600 cursor-pointer"
                                onclick="eliminarProducto(${producto.producto_id})">Eliminar</button>
                    </div>
                `;
                carritoContenedor.appendChild(item);
            });

            // Mostrar el bot√≥n "Realizar Pedido"
            document.getElementById("realizar-pedido-container").classList.remove("hidden");
        }


        // üõí Funci√≥n para eliminar un producto del carrito
        function eliminarProducto(productoId) {
            fetch(`/eliminar_carrito/${productoId}`, {
                method: "DELETE",  // Aqu√≠ usas DELETE
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": document.querySelector("[name=csrf_token]").value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log("‚úÖ Producto eliminado correctamente.");
                    cargarCarrito();  // Recargar el carrito
                } else {
                    console.error("‚ùå Error al eliminar producto:", data.error);
                }
            })
            .catch(error => {
                console.error("‚ùå Error en la solicitud:", error);
            });
        }

        // üõí Funci√≥n para actualizar la cantidad de un producto en el carrito
        function actualizarCantidad(productoId, nuevaCantidad) {
            nuevaCantidad = parseInt(nuevaCantidad);

            if (nuevaCantidad < 1) {
                alert("‚ùå La cantidad no puede ser menor a 1. Se ha ajustado autom√°ticamente.");
                nuevaCantidad = 1;
            }

            fetch(`/actualizar_carrito/${productoId}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": document.querySelector("[name=csrf_token]").value
                },
                body: JSON.stringify({ cantidad: nuevaCantidad })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log("‚úÖ Cantidad actualizada correctamente.");
                    cargarCarrito();  // Recargar el carrito
                } else {
                    console.error("‚ùå Error al actualizar cantidad:", data.error);
                }
            })
            .catch(error => {
                console.error("‚ùå Error en la solicitud:", error);
            });
        }
















    // üåç Selector de Pa√≠s
    const dropdownButton = document.getElementById('dropdownButton');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const options = dropdownMenu.querySelectorAll('a');

    dropdownButton.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdownMenu.classList.toggle('hidden');
    });

    options.forEach(option => {
        option.addEventListener('click', (e) => {
            e.preventDefault();
            const newImgSrc = option.querySelector('img').getAttribute('src');
            const newAlt = option.querySelector('img').getAttribute('alt');
            const newText = option.textContent.trim();

            // Actualizar el bot√≥n principal con la nueva bandera y texto
            const mainImg = dropdownButton.querySelector('img');
            mainImg.setAttribute('src', newImgSrc);
            mainImg.setAttribute('alt', newAlt);
            dropdownButton.querySelector('span').textContent = newText;

            dropdownMenu.classList.add('hidden'); // Cerrar el men√∫ despu√©s de seleccionar
        });
    });

    // Cerrar el men√∫ si el usuario hace clic fuera
    document.addEventListener('click', (e) => {
        if (!dropdownButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.add('hidden');
        }
    });

    // üîç Buscador
    const searchToggleButton = document.getElementById('searchToggleButton');
    const searchContainer = document.getElementById('searchContainer');
    const closeSearchButton = document.getElementById('closeSearchButton');

    document.addEventListener('click', (e) => {
    if (!searchToggleButton.contains(e.target) && !searchContainer.contains(e.target) && e.target.tagName !== "INPUT") {
        searchContainer.classList.add("hidden");
    }
});

    searchToggleButton.addEventListener('click', (e) => {
        e.stopPropagation();
        searchContainer.classList.toggle("hidden");
    });

    closeSearchButton.addEventListener('click', (e) => {
        e.stopPropagation();
        searchContainer.classList.add("hidden");
    });

    // Cerrar el buscador si el usuario hace clic fuera
    document.addEventListener('click', (e) => {
        if (!searchToggleButton.contains(e.target) && !searchContainer.contains(e.target)) {
            searchContainer.classList.add("hidden");
        }
    });
</script>
